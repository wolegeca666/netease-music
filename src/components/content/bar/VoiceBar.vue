<template>
  <div @click.stop="changeLeft" id="voice">
    <div :class="{'active': !active}" id="voice-progress">
      <div class="voice-bar-p">
        <div class="on" v-show="voice > 0">
          <svg class="icon" height="128" p-id="11321"
               t="1602239512909" version="1.1" viewBox="0 0 1024 1024"
               width="128" xmlns="http://www.w3.org/2000/svg">
            <path d="M651.96514759 264.65715883c68.31966891 68.34644765 102.41837853 157.75732281 102.41837852 247.37311288 0 89.58551837-34.03933013 179.02666411-102.35783509 247.37427684l27.68111503 27.62522852c75.80608626-75.92251619 113.82847033-175.55124338 113.76676181-274.99950536 0-99.44826197-38.01772601-199.10493298-113.9425701-274.99717745L651.96514759 264.65715883z m184.28345686-184.40221469l-27.56585018 27.62406457c111.62795235 111.68733184 167.35111395 257.77143125 167.41049344 404.09421255 0 146.29018055-55.7231616 292.45927424-167.2917356 404.14777003l27.62290062 27.62522852c119.05382627-119.23079965 178.81942016-275.5921317 178.75887673-431.7718346 0.00116395-156.18435982-59.64567097-312.54802091-178.93468501-431.71944107zM8.81438265 331.58083811l0.06054229 361.16898248 185.29290127-0.06170738 315.93262648 233.95111936-0.17930126-829.15737828L194.10844672 331.55056754l-185.29406407 0.03027057z m203.41398756 35.19664015l258.66095388-191.73610951 0.11875783 674.03951331-263.94918115-195.42226716H47.90675229l-0.05937835-283.02033465 159.15214734-0.02794268 5.22884893-3.83285931z"
                  fill="#8a8a8a" p-id="11322"></path>
          </svg>
        </div>
        <div style="margin-right: 4rem" v-show="voice === 0">
          <svg class="icon" height="128" p-id="9236"
               t="1602237152496"
               version="1.1" viewBox="0 0 1024 1024" width="128"
               xmlns="http://www.w3.org/2000/svg">
            <path d="M802.816 100.864c0 280.064 0 549.888 0 820.736-19.456 7.168-35.328 2.56-51.712-9.216-83.968-59.392-168.448-118.784-253.952-176.64-12.288-8.192-29.184-13.312-44.032-13.824-47.616-1.536-95.232-0.512-143.36-0.512-57.856-0.512-86.016-28.16-86.016-86.528-0.512-83.456-0.512-166.912 0-250.88 0-55.808 27.648-83.456 82.944-83.456 49.664 0 98.816 0.512 148.48-0.512 12.8-0.512 27.136-4.608 37.888-11.264C578.56 233.984 662.528 177.664 748.032 122.88 762.88 113.664 780.8 109.568 802.816 100.864zM757.76 169.984c-10.24 6.144-16.896 10.24-23.04 14.336C660.48 232.96 586.752 281.6 512 329.216c-13.312 8.704-31.232 12.8-47.616 13.312-51.2 1.536-102.4 0.512-153.6 0.512-32.256 0-44.032 10.752-44.544 41.984-0.512 83.456-0.512 166.912 0 250.88 0 31.232 10.24 39.936 42.496 40.448 51.2 0 102.4-1.024 153.6 0.512 15.872 0.512 33.792 5.632 47.104 14.336 75.776 50.688 150.016 103.424 225.28 155.136 6.656 4.608 13.824 8.704 23.04 14.848C757.76 630.272 757.76 401.92 757.76 169.984z"
                  fill="#8a8a8a" p-id="9237"></path>
          </svg>
        </div>
      </div>
      <div class="right">
        <progress-bar :left="left" :num="1" :percent="percent"
                      @progress="voiceHandle"></progress-bar>
      </div>
    </div>
    <div @mouseup="progress()" class="voice-bar">
      <div class="on" v-show="voice > 0">
        <svg class="icon" height="128" p-id="11321"
             t="1602239512909" version="1.1" viewBox="0 0 1024 1024"
             width="128" xmlns="http://www.w3.org/2000/svg">
          <path d="M651.96514759 264.65715883c68.31966891 68.34644765 102.41837853 157.75732281 102.41837852 247.37311288 0 89.58551837-34.03933013 179.02666411-102.35783509 247.37427684l27.68111503 27.62522852c75.80608626-75.92251619 113.82847033-175.55124338 113.76676181-274.99950536 0-99.44826197-38.01772601-199.10493298-113.9425701-274.99717745L651.96514759 264.65715883z m184.28345686-184.40221469l-27.56585018 27.62406457c111.62795235 111.68733184 167.35111395 257.77143125 167.41049344 404.09421255 0 146.29018055-55.7231616 292.45927424-167.2917356 404.14777003l27.62290062 27.62522852c119.05382627-119.23079965 178.81942016-275.5921317 178.75887673-431.7718346 0.00116395-156.18435982-59.64567097-312.54802091-178.93468501-431.71944107zM8.81438265 331.58083811l0.06054229 361.16898248 185.29290127-0.06170738 315.93262648 233.95111936-0.17930126-829.15737828L194.10844672 331.55056754l-185.29406407 0.03027057z m203.41398756 35.19664015l258.66095388-191.73610951 0.11875783 674.03951331-263.94918115-195.42226716H47.90675229l-0.05937835-283.02033465 159.15214734-0.02794268 5.22884893-3.83285931z"
                fill="#8a8a8a" p-id="11322"></path>
        </svg>
      </div>
      <div v-show="voice === 0">
        <svg class="icon" height="128" p-id="9236"
             t="1602237152496"
             version="1.1" viewBox="0 0 1024 1024" width="128"
             xmlns="http://www.w3.org/2000/svg">
          <path d="M802.816 100.864c0 280.064 0 549.888 0 820.736-19.456 7.168-35.328 2.56-51.712-9.216-83.968-59.392-168.448-118.784-253.952-176.64-12.288-8.192-29.184-13.312-44.032-13.824-47.616-1.536-95.232-0.512-143.36-0.512-57.856-0.512-86.016-28.16-86.016-86.528-0.512-83.456-0.512-166.912 0-250.88 0-55.808 27.648-83.456 82.944-83.456 49.664 0 98.816 0.512 148.48-0.512 12.8-0.512 27.136-4.608 37.888-11.264C578.56 233.984 662.528 177.664 748.032 122.88 762.88 113.664 780.8 109.568 802.816 100.864zM757.76 169.984c-10.24 6.144-16.896 10.24-23.04 14.336C660.48 232.96 586.752 281.6 512 329.216c-13.312 8.704-31.232 12.8-47.616 13.312-51.2 1.536-102.4 0.512-153.6 0.512-32.256 0-44.032 10.752-44.544 41.984-0.512 83.456-0.512 166.912 0 250.88 0 31.232 10.24 39.936 42.496 40.448 51.2 0 102.4-1.024 153.6 0.512 15.872 0.512 33.792 5.632 47.104 14.336 75.776 50.688 150.016 103.424 225.28 155.136 6.656 4.608 13.824 8.704 23.04 14.848C757.76 630.272 757.76 401.92 757.76 169.984z"
                fill="#8a8a8a" p-id="9237"></path>
        </svg>
      </div>
    </div>
  </div>
</template>

<script>
  import ProgressBar from "../../common/progress/ProgressBar";

  export default {
    name: "VoiceBar",
    data() {
      return {
        active: false,
        voice: 1,
        left: 0,
        percent: 0.99
      }
    },
    components: {
      ProgressBar
    },
    methods: {
      progress() {
        this.active = !this.active;
        if (this.active) {
          document.onclick = e => {
            // console.log(e)
            this.active = false;
            document.onclick = null;
          }
        }
      },
      changeLeft() {
        if (this.active) {
          this.left = this.width - 190;
        }
        this.percent = this.$store.state.songState.voice;
      },
      voiceHandle(percent) {
        this.voice = percent <= 0.015 ? 0 : percent > 1 ? 1 : percent;
        this.$store.commit('changeVoice', this.voice);
        this.percent = this.$store.state.songState.voice;
      }
    },
    computed: {
      width() {
        return this.$store.state.windowsWidth
      },
    }
  }
</script>

<style scoped>
  #voice {
    z-index: 200;
    flex: 1;
    background-color: #fff;
  }

  .icon {
    width: 1.8rem;
    height: 1.8rem;
  }

  .active {
    visibility: hidden;
    opacity: 0;
  }

  .on {
    padding: 0 0.5rem;
  }

  #voice-progress {
    transition: all 500ms;
    position: absolute;
    right: 1rem;
    bottom: 8rem;
    width: 23rem;
    height: 5rem;
    padding-left: 0.5rem;
    background-color: #fff;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .voice-bar {
    margin-left: 2rem;
  }

  .voice-bar-p {
    display: inline;
    line-height: 6rem;
  }

  .right {
    position: absolute;
    bottom: 6.4rem;
    right: 1rem;
    width: 18rem;
    height: 0;
  }

  .right::after {
    z-index: 200;
    content: "";
    position: absolute;
    top: 6.5rem;
    right: 8rem;
    border-top: 1rem solid #DD524D;
    border-right: 1rem solid transparent;
    border-bottom: 1rem solid transparent;
    border-left: 1rem solid transparent;
  }

</style>